version: '3.8'

services:
  redis_db:
    extends:
      file: ./services/docker-compose-redis.yml
      service: redis_db

  db:
    extends:
      file: ./services/docker-compose-db.yml
      service: db

  backend:
    depends_on:
      - db
      - redis_db
    extends:
      file: ./services/docker-compose-backend.yml
      service: backend
    links:
      - db:postgres
      - redis_db:redis_db


  smart-contract-verifier:
    extends:
      file: ./services/docker-compose-smart-contract-verifier.yml
      service: smart-contract-verifier

  # visualizer:
  #   extends:
  #     file: ./services/docker-compose-visualizer.yml
  #     service: visualizer

  # sig-provider:
  #   extends:
  #     file: ./services/docker-compose-sig-provider.yml
  #     service: sig-provider

  frontend:
    extends:
      file: ./services/docker-compose-frontend.yml
      service: frontend
    environment:
      NEXT_PUBLIC_API_HOST: ${NEXT_PUBLIC_API_HOST:-mainnet.amazechain.com}
      NEXT_PUBLIC_API_PROTOCOL: ${NEXT_PUBLIC_API_PROTOCOL:-https}
      NEXT_PUBLIC_APP_HOST: ${NEXT_PUBLIC_APP_HOST:-mainnet.amazechain.com}
      NEXT_PUBLIC_APP_PROTOCOL: ${NEXT_PUBLIC_APP_PROTOCOL:-https}
      NEXT_PUBLIC_API_WEBSOCKET_PROTOCOL: ${NEXT_PUBLIC_API_WEBSOCKET_PROTOCOL:-wss}

  proxy:
    depends_on:
      - backend
      - frontend
    extends:
      file: ./services/docker-compose-nginx.yml
      service: proxy


volumes:
  db-data:
    driver: local
  redis-data:
    driver: local
